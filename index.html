<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Play Songs from Folder</title>
</head>
<body>
  <h2>Select a folder with MP3 files:</h2>
  <button id="selectFolder">Choose Folder</button>
  <br><br>
  <audio id="audioPlayer" controls></audio>
  <ul id="playlist"></ul>

  <script>
    const selectFolderBtn = document.getElementById('selectFolder');
    const audioPlayer = document.getElementById('audioPlayer');
    const playlistEl = document.getElementById('playlist');
    let songs = [];
    let currentIndex = 0;

    selectFolderBtn.addEventListener('click', async () => {
      try {
        const dirHandle = await window.showDirectoryPicker();
        songs = [];

        for await (const [name, handle] of dirHandle.entries()) {
          if (handle.kind === 'file' && name.endsWith('.mp3')) {
            const file = await handle.getFile();
            const url = URL.createObjectURL(file);
            songs.push({ name, url });
          }
        }

        if (songs.length > 0) {
          currentIndex = 0;
          playSong(currentIndex);
          renderPlaylist();
        } else {
          alert('No MP3 files found in the selected folder.');
        }
      } catch (err) {
        console.error('Folder access cancelled or failed:', err);
      }
    });

    function playSong(index) {
      audioPlayer.src = songs[index].url;
      audioPlayer.play();
    }

    function renderPlaylist() {
      playlistEl.innerHTML = '';
      songs.forEach((song, i) => {
        const li = document.createElement('li');
        li.textContent = song.name;
        if (i === currentIndex) li.style.fontWeight = 'bold';
        playlistEl.appendChild(li);
      });
    }

    audioPlayer.addEventListener('ended', () => {
      currentIndex++;
      if (currentIndex < songs.length) {
        playSong(currentIndex);
        renderPlaylist();
      }
    });
  </script>
</body>
</html>
